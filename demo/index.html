<!--
title: index
description: 
published: true
date: 2025-10-15T15:49:38.922Z
tags: 
editor: code
dateCreated: 2025-10-15T15:04:00.190Z
-->

<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Revendo Ankauf - Partner Integration Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #007cba;
            padding-bottom: 10px;
        }
        .test-info {
            background: #e7f3ff;
            border-left: 4px solid #007cba;
            padding: 15px;
            margin: 20px 0;
        }

        /* Message Display Area */
        .message-area {
            background: #f9f9f9;
            border: 2px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin: 20px 0;
            min-height: 150px;
        }
        .message-area h3 {
            margin-top: 0;
            color: #555;
        }
        .message-log {
            max-height: 300px;
            overflow-y: auto;
            background: white;
            border-radius: 4px;
            padding: 10px;
        }
        .message-entry {
            padding: 8px;
            margin-bottom: 8px;
            border-left: 3px solid #007cba;
            background: #f0f8ff;
            border-radius: 3px;
            animation: slideIn 0.3s;
        }
        .message-entry.cart-update {
            border-left-color: #28a745;
            background: #f0fff4;
        }
        .message-entry.order-complete {
            border-left-color: #ffc107;
            background: #fffbf0;
            font-weight: bold;
        }
        .message-entry.resize-event {
            border-left-color: #17a2b8;
            background: #e7f5f8;
        }
        .message-time {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 5px;
        }
        .message-type {
            font-weight: bold;
            color: #007cba;
            margin-bottom: 5px;
        }
        .message-data {
            font-family: monospace;
            font-size: 0.9em;
            color: #444;
            white-space: pre-wrap;
            word-break: break-word;
        }
        .clear-messages {
            margin-top: 10px;
        }

        .iframe-container {
            border: 2px solid #ddd;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 20px;
            background: #fff;
            position: relative;
        }

        /* Iframe with fallback scrolling */
        #revendo-iframe {
            display: block;
            width: 100%;
            height: 800px;  /* Fixed height with scrolling as fallback */
            border: none;
        }

        /* Auto-resize mode styles */
        .iframe-container.auto-resize #revendo-iframe {
            min-height: 600px;
            transition: height 0.3s ease;
        }

        .test-actions {
            margin: 20px 0;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 4px;
        }
        button {
            background: #007cba;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background: #005a8a;
        }
        button.danger {
            background: #dc3545;
        }
        button.danger:hover {
            background: #c82333;
        }
        button.success {
            background: #28a745;
        }
        button.success:hover {
            background: #218838;
        }
        button.active {
            background: #28a745;
        }

        /* Status indicators */
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
            animation: pulse 2s infinite;
        }
        .status-indicator.active {
            background: #28a745;
        }
        .status-indicator.waiting {
            background: #ffc107;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* Lightbox styles */
        .lightbox-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 9999;
            animation: fadeIn 0.3s;
        }
        .lightbox-overlay.active {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .lightbox-content {
            width: 90%;
            height: 90%;
            max-width: 1200px;
            background: white;
            border-radius: 8px;
            position: relative;
            animation: slideIn 0.3s;
            overflow: auto;
        }
        .lightbox-close {
            position: absolute;
            top: -40px;
            right: 0;
            color: white;
            font-size: 30px;
            cursor: pointer;
            padding: 5px 15px;
            background: rgba(0,0,0,0.5);
            border-radius: 4px;
        }
        .lightbox-close:hover {
            background: rgba(0,0,0,0.8);
        }
        .lightbox-iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 8px;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideIn {
            from {
                transform: translateY(-30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        .token-display {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            word-break: break-all;
            margin-top: 10px;
        }

        /* Mode indicator */
        .mode-indicator {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        .mode-indicator.resize-mode {
            background: #28a745;
            color: white;
        }
        .mode-indicator.scroll-mode {
            background: #ffc107;
            color: #000;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Revendo Ankauf - Cross-Origin Iframe Test</h1>

        <div class="test-info">
            <h3>Test Configuration</h3>
            <p><strong>Parent Origin:</strong> <span id="parent-origin"></span></p>
            <p><strong>Iframe Origin:</strong> https://purchase.revendo.dev</p>
            <p><strong>Cross-Origin Status:</strong> ‚úÖ Active (Cookies blocked)</p>
            <p><strong>Expected Behavior:</strong> Token-based session management</p>
            <div class="token-display">
                <strong>Session Status:</strong> <span class="status-indicator waiting"></span><span id="token-status">Waiting for iframe...</span>
                <span id="mode-indicator" class="mode-indicator scroll-mode">Scroll Mode</span>
            </div>
        </div>

        <!-- PostMessage Display Area -->
        <div class="message-area">
            <h3>üì® PostMessage Events</h3>
            <div id="message-log" class="message-log">
                <div style="color: #999; text-align: center; padding: 20px;">
                    No messages received yet. Interact with the iframe below to see events.
                </div>
            </div>
            <button class="clear-messages danger" onclick="clearMessages()">Clear Messages</button>
        </div>

        <div class="test-actions">
            <h3>Test Actions</h3>
            <button onclick="reloadIframe()">üîÑ Reload Iframe</button>
            <button onclick="openLightbox()">üîç Open in Lightbox</button>
            <button id="resize-toggle" onclick="toggleResizeMode()">Enable Auto-Resize</button>
        </div>

        <div id="iframe-container" class="iframe-container">
            <iframe
                id="revendo-iframe"
                src="https://purchase.revendo.dev/sell-a-device-iframe/?iframe=1"
                >
            </iframe>
        </div>
    </div>

    <!-- Lightbox -->
    <div id="lightbox" class="lightbox-overlay">
        <div class="lightbox-content">
            <span class="lightbox-close" onclick="closeLightbox()">&times;</span>
            <iframe
                id="lightbox-iframe"
                class="lightbox-iframe"
                allow="payment">
            </iframe>
        </div>
    </div>

    <script>
        // Display current origin
        document.getElementById('parent-origin').textContent = window.location.origin;

        // Message tracking
        let messageCount = 0;
        let autoResize = false;

        function addMessage(event) {
            const log = document.getElementById('message-log');
            const timestamp = new Date().toLocaleTimeString();
            messageCount++;

            // Clear initial placeholder
            if (messageCount === 1) {
                log.innerHTML = '';
            }

            // Determine message type for styling
            let messageClass = 'message-entry';
            if (event.data.type === 'revendo_resize') {
                messageClass += ' resize-event';
            } else if (event.data.type === 'revendo_order_complete') {
                messageClass += ' order-complete';
            } else if (event.data.event === 'cart_updated') {
                messageClass += ' cart-update';
            }

            // Create message entry
            const entry = document.createElement('div');
            entry.className = messageClass;
            entry.innerHTML = `
                <div class="message-time">[${timestamp}] Message #${messageCount}</div>
                <div class="message-type">Type: ${event.data.type || event.data.event || 'Unknown'}</div>
                <div class="message-data">${JSON.stringify(event.data, null, 2)}</div>
            `;

            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;

            // Update status
            const statusIndicator = document.querySelector('.status-indicator');
            statusIndicator.classList.remove('waiting');
            statusIndicator.classList.add('active');
            document.getElementById('token-status').textContent = 'Active - Receiving messages';
        }

        function clearMessages() {
            const log = document.getElementById('message-log');
            log.innerHTML = `
                <div style="color: #999; text-align: center; padding: 20px;">
                    Messages cleared. Interact with the iframe to see new events.
                </div>
            `;
            messageCount = 0;
        }

        function toggleResizeMode() {
            autoResize = !autoResize;
            const container = document.getElementById('iframe-container');
            const button = document.getElementById('resize-toggle');
            const modeIndicator = document.getElementById('mode-indicator');

            if (autoResize) {
                container.classList.add('auto-resize');
                button.textContent = 'Disable Auto-Resize';
                button.classList.add('active');
                modeIndicator.textContent = 'Auto-Resize Mode';
                modeIndicator.className = 'mode-indicator resize-mode';

                // Try to get current height from iframe content
                const iframe = document.getElementById('revendo-iframe');
                iframe.contentWindow.postMessage({ type: 'request_height' }, 'https://purchase.revendo.dev');
            } else {
                container.classList.remove('auto-resize');
                button.textContent = 'Enable Auto-Resize';
                button.classList.remove('active');
                modeIndicator.textContent = 'Scroll Mode';
                modeIndicator.className = 'mode-indicator scroll-mode';

                // Reset to fixed height with scrolling
                const iframe = document.getElementById('revendo-iframe');
                iframe.style.height = '800px';
            }
        }

        // Message listener
        window.addEventListener('message', function(event) {
            if (event.origin === 'https://purchase.revendo.dev') {
                addMessage(event);

                // Only handle resize if auto-resize is enabled
                if (autoResize && event.data.type === 'revendo_resize') {
                    const height = parseInt(event.data.height);
                    if (height && !isNaN(height)) {
                        const iframe = document.getElementById('revendo-iframe');
                        const finalHeight = Math.max(600, height);
                        iframe.style.height = finalHeight + 'px';
                        console.log('Iframe resized to:', finalHeight + 'px');
                    }
                }

                // Handle order completion
                if (event.data.type === 'revendo_order_complete') {
                    console.log('Order completed!', event.data);
                }
            }
        });

        function reloadIframe() {
            const iframe = document.getElementById('revendo-iframe');
            const currentSrc = iframe.src;
            iframe.src = '';
            setTimeout(() => {
                iframe.src = currentSrc;
            }, 100);

            document.getElementById('token-status').textContent = 'Reloading iframe...';
            const statusIndicator = document.querySelector('.status-indicator');
            statusIndicator.classList.remove('active');
            statusIndicator.classList.add('waiting');
        }

        function openLightbox() {
            const lightbox = document.getElementById('lightbox');
            const lightboxIframe = document.getElementById('lightbox-iframe');
            lightboxIframe.src = 'https://purchase.revendo.dev/sell-a-device-iframe/?iframe=1';
            lightbox.classList.add('active');
        }

        function closeLightbox() {
            const lightbox = document.getElementById('lightbox');
            const lightboxIframe = document.getElementById('lightbox-iframe');
            lightbox.classList.remove('active');
            setTimeout(() => {
                lightboxIframe.src = '';
            }, 300);
        }

        // Keyboard and click handlers
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeLightbox();
            }
        });

        document.getElementById('lightbox').addEventListener('click', function(e) {
            if (e.target === this) {
                closeLightbox();
            }
        });
    </script>
</body>
</html>
